<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Dice Roulette</title>
	<link href='https://fonts.googleapis.com/css?family=Roboto Mono' rel='stylesheet'>
  <!-- <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"> -->
  <link rel="stylesheet" href="DiceRoulette.css">
</head>
<body>

<h1>Dice Roulette</h1>
<div class="tableWrapper">
<div class="betsWrapper">
	<div class="red" id="number16">16</div>	<div class="blk" id="number26">26</div>	<div class="red" id="number36">36</div>	<div class="blk" id="number46">46</div>	<div class="red" id="number56">56</div>	<div class="blk" id="number66">66</div>
	<div class="red" id="number15">15</div>	<div class="blk" id="number25">25</div>	<div class="red" id="number35">35</div>	<div class="blk" id="number45">45</div>	<div class="red" id="number55">55</div>	<div class="blk" id="number65">65</div>
	<div class="blk" id="number14">14</div>	<div class="red" id="number24">24</div>	<div class="blk" id="number34">34</div>	<div class="red" id="number44">44</div>	<div class="blk" id="number54">54</div>	<div class="red" id="number64">64</div>
	<div class="blk" id="number13">13</div>	<div class="red" id="number23">23</div>	<div class="blk" id="number33">33</div>	<div class="red" id="number43">43</div>	<div class="blk" id="number53">53</div>	<div class="red" id="number63">63</div>
	<div class="red" id="number12">12</div>	<div class="blk" id="number22">22</div>	<div class="red" id="number32">32</div>	<div class="blk" id="number42">42</div>	<div class="red" id="number52">52</div>	<div class="blk" id="number62">62</div>
	<div class="red" id="number11">11</div>	<div class="blk" id="number21">21</div>	<div class="red" id="number31">31</div>	<div class="blk" id="number41">41</div>	<div class="red" id="number51">51</div>	<div class="blk" id="number61">61</div>

  <div class="outsideBets" id="firstHalfRow">1st H</div>
  <div class="outsideBets" id="secondHalfRow">2nd H</div>
  <div class="outsideBets" id="first12Row">1st 12</div>
  <div class="outsideBets" id="second12Row">2nd 12</div>
  <div class="outsideBets" id="third12Row">3rd 12</div>
  <div class="outsideBets" id="row6">R6</div>
  <div class="outsideBets" id="row5">R5</div>
  <div class="outsideBets" id="row4">R4</div>
  <div class="outsideBets" id="row3">R3</div>
  <div class="outsideBets" id="row2">R2</div>
  <div class="outsideBets" id="row1">R1</div>

  <div class="outsideBets" id="firstHalfColumn">1st H</div>
  <div class="outsideBets" id="secondHalfColumn">2nd H</div>
  <div class="outsideBets" id="first12Column">1st 12</div>
  <div class="outsideBets" id="second12Column">2nd 12</div>
  <div class="outsideBets" id="third12Column">3rd 12</div>
  <div class="outsideBets" id="column1">C1</div>
  <div class="outsideBets" id="column2">C2</div>
  <div class="outsideBets" id="column3">C3</div>
  <div class="outsideBets" id="column4">C4</div>
  <div class="outsideBets" id="column5">C5</div>
  <div class="outsideBets" id="column6">C6</div>

  <div class="outsideBets" id="secondQuarter">2nd Q</div>
  <div class="outsideBets" id="fourthQuarter">4th Q</div>
  <div class="outsideBets" id="even">Even</div>
  <div class="outsideBets" id="firstQuarter">1st Q</div>
  <div class="outsideBets" id="thirdQuarter">3rd Q</div>
  <div class="outsideBets" id="odd">Odd</div>
  <div class="outsideBets red" id="allRed">Red</div>
  <div class="outsideBets blk" id="allBlk">Black</div>
  <div class="outsideBets" id="same">Same</div>
</div>
<div class="actionOverlay">
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
	<div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div><div class="insideBets"></div>
</div>

</div>
<div class="sideWrapper">
   <!-- dice icons: https://game-icons.net/tags/dice.html -->
  <img class="diceImage" id="diceImage1" src="dice/dice-blank.svg">
  <img class="diceImage" id="diceImage2" src="dice/dice-blank.svg">
	<button id="rollDiceButton" onclick="rollDice()">Roll dice</button>
    <br>
	<p>Bank roll:</p>
	<div id="bankRollAmount">1000</div>
	<p>Total bet:</p>
	<div id="totalBetAmount">0</div>
	  <br>
	<label for="betAmountSelector">Select a bet amount:</label>
  <select name="betAmountSelector" id="betAmountSelector" onchange="betAmountSelectorChanged()">
    <option value="1">1</option>
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="25">25</option>
    <option value="100">100</option>
    <option value="500">500</option>
  </select>
	  <br><br>
	<button id="clearAllBetsButton" onclick="clearAllBets()">Clear all bets</button>
</div>

<script src="lookups.js"></script>

<script>

// global variables
let	numberToMark;
let betAmount = 1; // init first default value
let bankRollAmount = 1000; // init default bankroll amount
let totalBetAmount = 0; // init default total bet amount
let rollDiceButton = document.getElementById("rollDiceButton");
let betAmountSelector = document.getElementById("betAmountSelector");
let clearAllBetsButton = document.getElementById("clearAllBetsButton");
let rollValueBoth;
let betsArray = []; // init empty array to store all current table bets

// automize HTML setup
// add chip images to table and hide them on load
let allOutsideBets = document.getElementsByClassName("outsideBets");
for (let i = 0; i < allOutsideBets.length; i++) {
	  let chipImageOutsideBet = document.createElement("img");
		chipImageOutsideBet.src = "chips/yellow.svg";
		chipImageOutsideBet.classList.add("chipImageOutsideBet");
    allOutsideBets[i].appendChild(chipImageOutsideBet);
    allOutsideBets[i].addEventListener('click', clickedBet, false);
}

let allInsideBets = document.getElementsByClassName("insideBets");
for (let i = 0; i < allInsideBets.length; i++) {
	  let chipImageInsideBet = document.createElement("img");
		chipImageInsideBet.src = "chips/yellow.svg";
		chipImageInsideBet.classList.add("chipImageInsideBet");
    allInsideBets[i].appendChild(chipImageInsideBet);
    allInsideBets[i].addEventListener('click', clickedBet, false);
}

function clickedBet() {
	// only allow if dice are not rolling
	if (rollDiceButton.disabled == false) {
  	// toggle OFF
    if (this.children[0].style.visibility == "visible") {
      this.children[0].style.visibility = "hidden";
  		bankRollAmount += betAmount;
  		document.getElementById("bankRollAmount").innerHTML = bankRollAmount;
  		// enable roll button again if bankroll positive
  		if (bankRollAmount >= 0) {
  			rollDiceButton.disabled = false;
  		}
  		totalBetAmount -= betAmount;
  		document.getElementById("totalBetAmount").innerHTML = totalBetAmount;
			// remove id of clicked div to betsArray, use indexOf() and splice()
			// https://www.delftstack.com/howto/javascript/javascript-remove-from-array-by-value/
			betsArray.splice(betsArray.indexOf(this.id), 1);
    }
    // toggle ON
    else {
      this.children[0].style.visibility = "visible";
      bankRollAmount -= betAmount;
  		document.getElementById("bankRollAmount").innerHTML = bankRollAmount;
  		// disable roll button if negative bankroll
  		if (bankRollAmount < 0) {
  			rollDiceButton.disabled = true;
  		}
  		totalBetAmount += betAmount;
  		document.getElementById("totalBetAmount").innerHTML = totalBetAmount;
			// add id of clicked div to betsArray
			betsArray.push(this.id);
    }
	}
}

function clearAllChips() {
  let allChipImagesInsideBets = document.getElementsByClassName("chipImageInsideBet");
	for (let i = 0; i < allChipImagesInsideBets.length; i++) {
		allChipImagesInsideBets[i].style.visibility = "hidden";
	}
	let allChipImagesOutsideBets = document.getElementsByClassName("chipImageOutsideBet");
	for (let i = 0; i < allChipImagesOutsideBets.length; i++) {
		allChipImagesOutsideBets[i].style.visibility = "hidden";
	}
	// remove all ids of betsArray
	// https://stackoverflow.com/questions/1232040/how-do-i-empty-an-array-in-javascript/8134354#8134354
	betsArray.splice(0, betsArray.length);
}

function clearTotalBet() {
	bankRollAmount += totalBetAmount; // add total bets to bankroll again
	totalBetAmount -= totalBetAmount; // set total bets to zero
	document.getElementById("bankRollAmount").innerHTML = bankRollAmount;
	document.getElementById("totalBetAmount").innerHTML = totalBetAmount;
	// enable roll button again once negative bet is cleared
	if (bankRollAmount >= 0) {
		rollDiceButton.disabled = false;
	}
}

function betAmountSelectorChanged() {
	// input value is fetched as text, convert to number first
	// https://www.w3schools.com/jsref/jsref_number.asp
	betAmount = Number(document.getElementById("betAmountSelector").value);
	clearAllChips();
	clearTotalBet();
}

function clearAllBets() {
	// for manual button use
	// TODO: only enable button if there are chips on table, difficult to check
	clearAllChips();
	clearTotalBet();
}

function rollDice() {
  // https://stackoverflow.com/questions/13831601/disabling-and-enabling-a-html-input-button
  rollDiceButton.disabled = true;
	betAmountSelector.disabled = true;
	clearAllBetsButton.disabled = true;

	// initialize counter starting at 1
	let animationCounter = 1;
	// initialize empty variables
	let rollValue1;
	let rollValue2;


	// Clear previous marked number if marked
	// https://stackoverflow.com/questions/3390396/how-can-i-check-for-undefined-in-javascript
	if (typeof numberToMark !== 'undefined') {
	numberToMark.style.boxShadow = "none";
  }

	// https://javascript.info/js-animation
	// repeat random times with Timeout for animation https://www.w3schools.com/js/js_timing.asp
	// https://www.w3schools.com/jsref/met_win_setinterval.asp
	// start loop withdelay with setInterval() and stop with clearInterval()
	let rollAnimation = setInterval(function() {
    // animation repeats until done
	  if (animationCounter >= 15) {
			// What to do after animation
	    clearInterval(rollAnimation); // finish the animation
			animationCounter = 1; // reset counter
			// https://stackoverflow.com/questions/1723716/how-to-concatenate-two-numbers-in-javascript
			rollValueBoth = `${rollValue1}${rollValue2}`;
			markRolledNumber(rollValueBoth);
			// check all bets
			checkAllBetsWonLost();
			// enable input again after function
			rollDiceButton.disabled = false;
			betAmountSelector.disabled = false;
			clearAllBetsButton.disabled = false;

	    return;
	  }

		let diceImage1 = document.getElementById("diceImage1");
	  rollValue1 = Math.floor(Math.random() * 6) + 1;
		diceImage1.src = "dice/dice-"+ rollValue1 +".svg";

		let diceImage2 = document.getElementById("diceImage2");
		rollValue2 = Math.floor(Math.random() * 6) + 1;
	  diceImage2.src = "dice/dice-"+ rollValue2 +".svg";

		animationCounter += 1;
  // delay time
	}, 75);
}

function markRolledNumber(param) {
	let constructedID = "number"+param;
  numberToMark = document.getElementById(constructedID);
	// border without affecting size: https://www.delftstack.com/howto/css/css-inner-border/
	// can easily be applied and removed without affecting border
	numberToMark.style.boxShadow = "0px 0px 0px 5px #0F0 inset";
}

function checkAllBetsWonLost() {
	let winnings = 0; // init winnings
	let losings = 0; // init losings
	// https://stackoverflow.com/questions/7486085/copy-array-by-value
	// let removedBetsArray = betsArray; init copy, store array with removed bets outside loop
  // NO, instead use backwards loop: https://stackoverflow.com/questions/7486085/copy-array-by-value

  // https://stackoverflow.com/questions/24403732/how-to-check-if-array-is-empty-or-does-not-exist
  if (betsArray.length == 0) {
		alert("No bets!");
		return;
	}
	for (var i = betsArray.length - 1; i >= 0; i--) { // TODO: remove backup: let i = 0; i < betsArray.length; i++
		// https://www.w3schools.com/jsref/jsref_includes_array.asp
		// can an array value be used as a object name? NO...
		// String to Object type??
		// let winningValueMap = winningValuesMapper(betsArray[i]); -> WORKS
		// eval() -> WORKS, why not use it?
		// https://stackoverflow.com/questions/10953303/javascript-interpret-string-as-object-reference/10953396
		// https://humanwhocodes.com/blog/2013/06/25/eval-isnt-evil-just-misunderstood/
		// Is winning number in serie of bet?
    // WON BET
		let lookupBetArray = eval(betsArray[i]);
		let betString = String(betsArray[i]);
    if (lookupBetArray.includes(Number(rollValueBoth))) {
			// get risk of bet -> Needs bet name, not array of winning numbers (returned with eval)
			let payoutRisk = payoutLookupValues[betString];
			// add winning for this roll to total winnings
			winnings += payoutRisk * betAmount;
			// add bet winning to bank roll
			bankRollAmount += payoutRisk * betAmount;
			document.getElementById("bankRollAmount").innerHTML = bankRollAmount;
			// TODO: add visual of how many won (and lost?)
			// leave winning bet on the table
		}
		// LOST BET
		else {
			losings += betAmount;
			// remove losing bet from table (hide image)
			document.getElementById(betString).children[0].style.visibility = "hidden";
			// WARNING: removing bet from betsArray shortens length and breaks loop
			// https://stackoverflow.com/questions/57753537/remove-array-item-using-for-of-loop
			betsArray.splice(betsArray.indexOf(betString), 1);
			// remove from totalBetAmount
			totalBetAmount -= betAmount;
  		document.getElementById("totalBetAmount").innerHTML = totalBetAmount;
		}
	}

	// Roll Dice
	// -> Winning number = 52
	//
	// Get all bets (get from stored array)
	// -> loop through all the bets
	// --> Is winning number in serie of bet?
	// ---> If yes: "winnings" = (risk of bet 5:1) * bet amount
	//      Bet remains on table?
	// ---> If no: Bank roll - bet amount
	//      Remove bet from table?
}


</script>



</body>
</html>
